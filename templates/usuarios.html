<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gestión de Usuarios</title>
    <style>
        body { font-family: Arial; margin: 2em; }
        input, button { margin: 0.5em; }
        table, th, td { border: 1px solid black; border-collapse: collapse; padding: 0.5em; }
    </style>
</head>
<body>
    <h1>Gestión de Usuarios</h1>

    <h2>Crear Usuario</h2>
    <form id="createForm">
        <input placeholder="Nombre" name="nombre">
        <input placeholder="Usuario" name="nick_name">
        <input placeholder="Correo" name="email">
        <input placeholder="Contraseña" name="password">
        <input placeholder="Rol" name="role">
        <input placeholder="Imagen" name="image">
        <button type="submit">Crear</button>
    </form>

    <h2>Lista de Usuarios</h2>
    <button onclick="loadUsers()">Actualizar Lista</button>
    <table id="usersTable">
        <thead>
            <tr>
                <th>ID</th><th>Nombre</th><th>Usuario</th><th>Correo</th><th>Rol</th><th>Imagen</th><th>Acciones</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        async function loadUsers() {
            const res = await fetch('/api/users/');
            const users = await res.json();
            const tbody = document.querySelector("#usersTable tbody");
            tbody.innerHTML = "";
            users.forEach(u => {
                const row = `<tr>
                    <td>${u[0]}</td>
                    <td>${u[1]}</td>
                    <td>${u[2]}</td>
                    <td>${u[3]}</td>
                    <td>${u[5]}</td>
                    <td>${u[6]}</td>
                    <td><button onclick="deleteUser(${u[0]})">Eliminar</button></td>
                </tr>`;
                tbody.innerHTML += row;
            });
        }

        async function deleteUser(id) {
            await fetch(`/api/users/${id}`, { method: 'DELETE' });
            loadUsers();
        }

        document.querySelector("#createForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            const data = Object.fromEntries(new FormData(e.target));
            await fetch('/api/users/', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            e.target.reset();
            loadUsers();
        });

        loadUsers();  // Carga inicial
    </script>
</body>
</html>
